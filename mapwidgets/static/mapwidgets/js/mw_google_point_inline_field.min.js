!function(e){var t=!1,o=/xyz/.test(function(){xyz})?/\bSuper\b/:/.*/;e.Class=function(){},e.Class.extend=function(e){function a(){!t&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;t=!0;var i=new this;t=!1;for(var r in e)i[r]="function"==typeof e[r]&&"function"==typeof n[r]&&o.test(e[r])?function(e,t){return function(){var o=this.Super;this.Super=n[e];var a=t.apply(this,arguments);return this.Super=o,a}}(r,e[r]):e[r];return a.prototype=i,a.constructor=a,a.extend=arguments.callee,a},void 0===Function.bind&&(Function.prototype.bind=function(e){var t=this;return tmp=function(){return t.apply(e,arguments)},tmp}),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1})}(jQuery||django.jQuery),function(e){DjangoMapWidgetBase=e.Class.extend({init:function(t){e.extend(this,t),this.coordinatesOverlayToggleBtn.on("click",this.toggleCoordinatesOverlay.bind(this)),this.coordinatesOverlayDoneBtn.on("click",this.handleCoordinatesOverlayDoneBtnClick.bind(this)),this.coordinatesOverlayInputs.on("change",this.handleCoordinatesInputsChange.bind(this)),this.addMarkerBtn.on("click",this.handleAddMarkerBtnClick.bind(this)),this.myLocationBtn.on("click",this.handleMyLocationBtnClick.bind(this)),this.deleteBtn.on("click",this.deleteMarker.bind(this));var o=new google.maps.places.Autocomplete(this.addressAutoCompleteInput,this.GooglePlaceAutocompleteOptions);google.maps.event.addListener(o,"place_changed",this.handleAutoCompletePlaceChange.bind(this,o)),google.maps.event.addDomListener(this.addressAutoCompleteInput,"keydown",this.handleAutoCompleteInputKeyDown.bind(this)),this.geocoder=new google.maps.Geocoder,this.initializeMap()},initializeMap:function(){console.warn("Implement initializeMap method.")},updateMap:function(e,t){console.warn("Implement updateMap method.")},addMarkerToMap:function(e,t){console.warn("Implement this method for your map js library.")},fitBoundMarker:function(){console.warn("Implement this method for your map js library.")},removeMarker:function(){console.warn("Implement this method for your map js library.")},dragMarker:function(e){console.warn("Implement dragMarker method.")},handleMapClick:function(e){console.warn("Implement handleMapClick method.")},handleAddMarkerBtnClick:function(e){console.warn("Implement handleAddMarkerBtnClick method.")},isInt:function(e){return!isNaN(e)&&parseInt(Number(e))===e&&!isNaN(parseInt(e,10))},getLocationValues:function(){var e=this.locationInput.val().split(" ");return{lat:e[2].replace(/[\(\)]/g,""),lng:e[1].replace(/[\(\)]/g,"")}},callPlaceTriggerHandler:function(t,o,a){if(void 0===a){var n={lat:parseFloat(t),lng:parseFloat(o)};this.geocoder.geocode({location:n},function(a,n){if(n===google.maps.GeocoderStatus.OK){var i=a[0]||{};e(this.addressAutoCompleteInput).val(i.formatted_address||""),this.fillInputs(i),e(document).trigger(this.placeChangedTriggerNameSpace,[i,t,o,this.wrapElemSelector,this.locationInput])}}.bind(this))}else e(document).trigger(this.placeChangedTriggerNameSpace,[a,t,o,this.wrapElemSelector,this.locationInput])},updateLocationInput:function(t,o,a){var n="POINT ("+o+" "+t+")";this.locationInput.val(n),this.updateCoordinatesInputs(t,o),this.addMarkerToMap(t,o),e.isEmptyObject(this.locationFieldValue)?e(document).trigger(this.markerCreateTriggerNameSpace,[t,o,this.wrapElemSelector,this.locationInput]):e(document).trigger(this.markerChangeTriggerNameSpace,[t,o,this.wrapElemSelector,this.locationInput]),this.callPlaceTriggerHandler(t,o,a),this.locationFieldValue={lng:o,lat:t},this.deleteBtn.removeClass("mw-btn-default disabled").addClass("mw-btn-danger")},deleteMarker:function(){e.isEmptyObject(this.locationFieldValue)||(this.hideOverlay(),this.locationInput.val(""),this.coordinatesOverlayInputs.val(""),e(this.addressAutoCompleteInput).val(""),this.addMarkerBtn.removeClass("active"),this.removeMarker(),this.deleteBtn.removeClass("mw-btn-danger").addClass("mw-btn-default disabled"),e(document).trigger(this.markerDeleteTriggerNameSpace,[this.locationFieldValue.lat,this.locationFieldValue.lng,this.wrapElemSelector,this.locationInput]),this.locationFieldValue=null)},toggleCoordinatesOverlay:function(){this.coordinatesOverlayToggleBtn.toggleClass("active"),e(".mw-coordinates-overlay",this.wrapElemSelector).toggleClass("hide")},updateCoordinatesInputs:function(t,o){e(".mw-overlay-latitude",this.wrapElemSelector).val(t||""),e(".mw-overlay-longitude",this.wrapElemSelector).val(o||"")},handleCoordinatesInputsChange:function(t){var o=e(".mw-overlay-latitude",this.wrapElemSelector).val(),a=e(".mw-overlay-longitude",this.wrapElemSelector).val();o&&a&&(this.updateLocationInput(o,a),this.fitBoundMarker())},handleCoordinatesOverlayDoneBtnClick:function(){e(".mw-coordinates-overlay",this.wrapElemSelector).addClass("hide")},handleMyLocationBtnClick:function(){this.showOverlay(),navigator.geolocation?navigator.geolocation.getCurrentPosition(this.handleCurrentPosition.bind(this),this.handlecurrentPositionError.bind(this)):this.handlecurrentPositionError()},handleCurrentPosition:function(e){this.updateLocationInput(e.coords.latitude,e.coords.longitude),this.hideOverlay(),this.fitBoundMarker()},handlecurrentPositionError:function(){this.hideOverlay(),alert("Your location could not be found.")},handleAutoCompleteInputKeyDown:function(e){13===(e.keyCode||e.which)&&e.preventDefault()},handleAutoCompletePlaceChange:function(e){var t=e.getPlace(),o=t.geometry.location.lat(),a=t.geometry.location.lng();this.updateLocationInput(o,a,t),this.fitBoundMarker(),this.fillInputs(t)},showOverlay:function(){this.loaderOverlayElem.removeClass("hide")},hideOverlay:function(){this.loaderOverlayElem.addClass("hide")},fillInputs:function(t){if(1===e("#id_street_address").length){for(var o=t.address_components,a="",n="",i="",r=null,l="",s=0;s<o.length;s++)-1!=(l=(r=o[s]).types.join(", ")).indexOf("administrative_area_level_1")?i=r.short_name:-1!=l.indexOf("locality")?n=r.long_name:-1!=l.indexOf("street_number")?a+=r.long_name+" ":-1!=l.indexOf("route")&&(a+=r.long_name);""==a&&t.name&&(a=t.name),document.getElementById("id_street_address").value=a,document.getElementById("id_city").value=n,document.getElementById("id_state").value=i}}})}(jQuery||django.jQuery),function(e){DjangoGooglePointFieldWidget=DjangoMapWidgetBase.extend({initializeMap:function(){var t=this.mapCenterLocation;this.mapCenterLocationName?this.geocoder.geocode({address:this.mapCenterLocationName},function(o,a){if(a===google.maps.GeocoderStatus.OK){var n=o[0].geometry.location;t=[n.lat(),n.lng()]}else console.warn("Cannot find "+this.mapCenterLocationName+" on google geo service.");this.map=new google.maps.Map(this.mapElement,{center:new google.maps.LatLng(t[0],t[1]),scrollwheel:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT},zoom:this.zoom}),e.isEmptyObject(this.locationFieldValue)||(this.updateLocationInput(this.locationFieldValue.lat,this.locationFieldValue.lng),this.fitBoundMarker())}.bind(this)):(this.map=new google.maps.Map(this.mapElement,{center:new google.maps.LatLng(t[0],t[1]),scrollwheel:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT},zoom:this.zoom}),e.isEmptyObject(this.locationFieldValue)||(this.updateLocationInput(this.locationFieldValue.lat,this.locationFieldValue.lng),this.fitBoundMarker()))},addMarkerToMap:function(e,t){this.removeMarker();var o={lat:parseFloat(e),lng:parseFloat(t)};this.marker=new google.maps.Marker({position:o,map:this.map,draggable:!0}),this.marker.addListener("dragend",this.dragMarker.bind(this))},fitBoundMarker:function(){var e=new google.maps.LatLngBounds;if(e.extend(this.marker.getPosition()),this.map.fitBounds(e),this.markerFitZoom&&this.isInt(this.markerFitZoom))var t=parseInt(this.markerFitZoom),o=google.maps.event.addListener(this.map,"bounds_changed",function(){this.getZoom()>t&&this.setZoom(t),google.maps.event.removeListener(o)})},removeMarker:function(e){this.marker&&this.marker.setMap(null)},dragMarker:function(e){this.updateLocationInput(e.latLng.lat(),e.latLng.lng())},handleAddMarkerBtnClick:function(t){e(this.mapElement).toggleClass("click"),this.addMarkerBtn.toggleClass("active"),e(this.addMarkerBtn).hasClass("active")?this.map.addListener("click",this.handleMapClick.bind(this)):google.maps.event.clearListeners(this.map,"click")},handleMapClick:function(t){google.maps.event.clearListeners(this.map,"click"),e(this.mapElement).removeClass("click"),this.addMarkerBtn.removeClass("active"),this.updateLocationInput(t.latLng.lat(),t.latLng.lng())}})}(jQuery||django.jQuery),function(e){DjangoMapWidgetGenerater=e.Class.extend({init:function(t){e.extend(this,t),e(document).on("formset:added",this.handle_added_formset_row.bind(this))},handle_added_formset_row:function(t,o,a){var n=this.mapOptions,i={},r=new RegExp("("+a+"-(\\d+|__prefix__))"),l=/\d+/g,s=a+"-"+e(o).attr("id").match(l);e.each(this.widgetDataTemplate,function(e,t){i[e]=t.replace(r,s)});var d=i.wrapElemSelector,c=i.mapElemID,m=i.googleAutoInputID,h=i.locationInputID,p={locationInput:e(h),wrapElemSelector:d,locationFieldValue:this.fieldValue,mapApiKey:null,mapElement:document.getElementById(c),mapCenterLocationName:n.mapCenterLocationName,mapCenterLocation:n.mapCenterLocation,coordinatesOverlayToggleBtn:e(".mw-btn-coordinates",d),coordinatesOverlayDoneBtn:e(".mw-btn-coordinates-done",d),coordinatesOverlayInputs:e(".mw-overlay-input",d),coordinatesOverlay:e(".mw-coordinates-overlay",d),myLocationBtn:e(".mw-btn-my-location",d),addressAutoCompleteInput:document.getElementById(m),deleteBtn:e(".mw-btn-delete",d),addMarkerBtn:e(".mw-btn-add-marker",d),loaderOverlayElem:e(".mw-loader-overlay",d),zoom:n.zoom,markerFitZoom:n.markerFitZoom,GooglePlaceAutocompleteOptions:n.GooglePlaceAutocompleteOptions,markerCreateTriggerNameSpace:"google_point_map_widget:marker_create",markerChangeTriggerNameSpace:"google_point_map_widget:marker_change",markerDeleteTriggerNameSpace:"google_point_map_widget:marker_delete",placeChangedTriggerNameSpace:"google_point_map_widget:place_changed"};new DjangoGooglePointFieldWidget(p)}})}(jQuery||django.jQuery);