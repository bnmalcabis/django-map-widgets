!function(e){var t=!1,n=/xyz/.test(function(){xyz})?/\bSuper\b/:/.*/;e.Class=function(){},e.Class.extend=function(e){function o(){!t&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;t=!0;var a=new this;t=!1;for(var r in e)a[r]="function"==typeof e[r]&&"function"==typeof i[r]&&n.test(e[r])?function(e,t){return function(){var n=this.Super;this.Super=i[e];var o=t.apply(this,arguments);return this.Super=n,o}}(r,e[r]):e[r];return o.prototype=a,o.constructor=o,o.extend=arguments.callee,o},void 0===Function.bind&&(Function.prototype.bind=function(e){var t=this;return tmp=function(){return t.apply(e,arguments)},tmp}),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1})}(jQuery||django.jQuery),function(e){DjangoMapWidgetBase=e.Class.extend({init:function(t){e.extend(this,t),this.coordinatesOverlayToggleBtn.on("click",this.toggleCoordinatesOverlay.bind(this)),this.coordinatesOverlayDoneBtn.on("click",this.handleCoordinatesOverlayDoneBtnClick.bind(this)),this.coordinatesOverlayInputs.on("change",this.handleCoordinatesInputsChange.bind(this)),this.addMarkerBtn.on("click",this.handleAddMarkerBtnClick.bind(this)),this.myLocationBtn.on("click",this.handleMyLocationBtnClick.bind(this)),this.deleteBtn.on("click",this.deleteMarker.bind(this));var n=new google.maps.places.Autocomplete(this.addressAutoCompleteInput,this.GooglePlaceAutocompleteOptions);google.maps.event.addListener(n,"place_changed",this.handleAutoCompletePlaceChange.bind(this,n)),google.maps.event.addDomListener(this.addressAutoCompleteInput,"keydown",this.handleAutoCompleteInputKeyDown.bind(this)),this.geocoder=new google.maps.Geocoder,this.initializeMap()},initializeMap:function(){console.warn("Implement initializeMap method.")},updateMap:function(e,t){console.warn("Implement updateMap method.")},addMarkerToMap:function(e,t){console.warn("Implement this method for your map js library.")},fitBoundMarker:function(){console.warn("Implement this method for your map js library.")},removeMarker:function(){console.warn("Implement this method for your map js library.")},dragMarker:function(e){console.warn("Implement dragMarker method.")},handleMapClick:function(e){console.warn("Implement handleMapClick method.")},handleAddMarkerBtnClick:function(e){console.warn("Implement handleAddMarkerBtnClick method.")},isInt:function(e){return!isNaN(e)&&parseInt(Number(e))===e&&!isNaN(parseInt(e,10))},getLocationValues:function(){var e=this.locationInput.val().split(" ");return{lat:e[2].replace(/[\(\)]/g,""),lng:e[1].replace(/[\(\)]/g,"")}},callPlaceTriggerHandler:function(t,n,o){if(void 0===o){var i={lat:parseFloat(t),lng:parseFloat(n)};this.geocoder.geocode({location:i},function(o,i){if(i===google.maps.GeocoderStatus.OK){var a=o[0]||{};e(this.addressAutoCompleteInput).val(a.formatted_address||""),this.fillInputs(a),e(document).trigger(this.placeChangedTriggerNameSpace,[a,t,n,this.wrapElemSelector,this.locationInput])}}.bind(this))}else e(document).trigger(this.placeChangedTriggerNameSpace,[o,t,n,this.wrapElemSelector,this.locationInput])},updateLocationInput:function(t,n,o){var i="POINT ("+n+" "+t+")";this.locationInput.val(i),this.updateCoordinatesInputs(t,n),this.addMarkerToMap(t,n),e.isEmptyObject(this.locationFieldValue)?e(document).trigger(this.markerCreateTriggerNameSpace,[t,n,this.wrapElemSelector,this.locationInput]):e(document).trigger(this.markerChangeTriggerNameSpace,[t,n,this.wrapElemSelector,this.locationInput]),this.callPlaceTriggerHandler(t,n,o),this.locationFieldValue={lng:n,lat:t},this.deleteBtn.removeClass("mw-btn-default disabled").addClass("mw-btn-danger")},deleteMarker:function(){e.isEmptyObject(this.locationFieldValue)||(this.hideOverlay(),this.locationInput.val(""),this.coordinatesOverlayInputs.val(""),e(this.addressAutoCompleteInput).val(""),this.addMarkerBtn.removeClass("active"),this.removeMarker(),this.deleteBtn.removeClass("mw-btn-danger").addClass("mw-btn-default disabled"),e(document).trigger(this.markerDeleteTriggerNameSpace,[this.locationFieldValue.lat,this.locationFieldValue.lng,this.wrapElemSelector,this.locationInput]),this.locationFieldValue=null)},toggleCoordinatesOverlay:function(){this.coordinatesOverlayToggleBtn.toggleClass("active"),e(".mw-coordinates-overlay",this.wrapElemSelector).toggleClass("hide")},updateCoordinatesInputs:function(t,n){e(".mw-overlay-latitude",this.wrapElemSelector).val(t||""),e(".mw-overlay-longitude",this.wrapElemSelector).val(n||"")},handleCoordinatesInputsChange:function(t){var n=e(".mw-overlay-latitude",this.wrapElemSelector).val(),o=e(".mw-overlay-longitude",this.wrapElemSelector).val();n&&o&&(this.updateLocationInput(n,o),this.fitBoundMarker())},handleCoordinatesOverlayDoneBtnClick:function(){e(".mw-coordinates-overlay",this.wrapElemSelector).addClass("hide")},handleMyLocationBtnClick:function(){this.showOverlay(),navigator.geolocation?navigator.geolocation.getCurrentPosition(this.handleCurrentPosition.bind(this),this.handlecurrentPositionError.bind(this)):this.handlecurrentPositionError()},handleCurrentPosition:function(e){this.updateLocationInput(e.coords.latitude,e.coords.longitude),this.hideOverlay(),this.fitBoundMarker()},handlecurrentPositionError:function(){this.hideOverlay(),alert("Your location could not be found.")},handleAutoCompleteInputKeyDown:function(e){13===(e.keyCode||e.which)&&e.preventDefault()},handleAutoCompletePlaceChange:function(e){var t=e.getPlace(),n=t.geometry.location.lat(),o=t.geometry.location.lng();this.updateLocationInput(n,o,t),this.fitBoundMarker(),this.fillInputs(t)},showOverlay:function(){this.loaderOverlayElem.removeClass("hide")},hideOverlay:function(){this.loaderOverlayElem.addClass("hide")},fillInputs:function(t){if(1===e("#id_street_address").length){for(var n=t.address_components,o="",i="",a="",r=null,l="",s=0;s<n.length;s++)-1!=(l=(r=n[s]).types.join(", ")).indexOf("administrative_area_level_1")?a=r.short_name:-1!=l.indexOf("locality")?i=r.long_name:-1!=l.indexOf("street_number")?o+=r.long_name+" ":-1!=l.indexOf("route")&&(o+=r.long_name);""==o&&t.name&&(o=t.name),document.getElementById("id_street_address").value=o,document.getElementById("id_city").value=i,document.getElementById("id_state").value=a}}})}(jQuery||django.jQuery),function(e){DjangoGooglePointFieldWidget=DjangoMapWidgetBase.extend({initializeMap:function(){var t=this.mapCenterLocation;this.mapCenterLocationName?this.geocoder.geocode({address:this.mapCenterLocationName},function(n,o){if(o===google.maps.GeocoderStatus.OK){var i=n[0].geometry.location;t=[i.lat(),i.lng()]}else console.warn("Cannot find "+this.mapCenterLocationName+" on google geo service.");this.map=new google.maps.Map(this.mapElement,{center:new google.maps.LatLng(t[0],t[1]),scrollwheel:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT},zoom:this.zoom}),e.isEmptyObject(this.locationFieldValue)||(this.updateLocationInput(this.locationFieldValue.lat,this.locationFieldValue.lng),this.fitBoundMarker())}.bind(this)):(this.map=new google.maps.Map(this.mapElement,{center:new google.maps.LatLng(t[0],t[1]),scrollwheel:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT},zoom:this.zoom}),e.isEmptyObject(this.locationFieldValue)||(this.updateLocationInput(this.locationFieldValue.lat,this.locationFieldValue.lng),this.fitBoundMarker()))},addMarkerToMap:function(e,t){this.removeMarker();var n={lat:parseFloat(e),lng:parseFloat(t)};this.marker=new google.maps.Marker({position:n,map:this.map,draggable:!0}),this.marker.addListener("dragend",this.dragMarker.bind(this))},fitBoundMarker:function(){var e=new google.maps.LatLngBounds;if(e.extend(this.marker.getPosition()),this.map.fitBounds(e),this.markerFitZoom&&this.isInt(this.markerFitZoom))var t=parseInt(this.markerFitZoom),n=google.maps.event.addListener(this.map,"bounds_changed",function(){this.getZoom()>t&&this.setZoom(t),google.maps.event.removeListener(n)})},removeMarker:function(e){this.marker&&this.marker.setMap(null)},dragMarker:function(e){this.updateLocationInput(e.latLng.lat(),e.latLng.lng())},handleAddMarkerBtnClick:function(t){e(this.mapElement).toggleClass("click"),this.addMarkerBtn.toggleClass("active"),e(this.addMarkerBtn).hasClass("active")?this.map.addListener("click",this.handleMapClick.bind(this)):google.maps.event.clearListeners(this.map,"click")},handleMapClick:function(t){google.maps.event.clearListeners(this.map,"click"),e(this.mapElement).removeClass("click"),this.addMarkerBtn.removeClass("active"),this.updateLocationInput(t.latLng.lat(),t.latLng.lng())}})}(jQuery||django.jQuery);